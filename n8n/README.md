# Интеграция с ИИ через n8n

## 1. Цель

Автоматизация процессов генерации визуального контента (изображений персонажей, локаций, событий) с помощью нейронных сетей. n8n выступает в роли связующего звена (middleware) между бэкендом игры и ИИ-моделями.

## 2. Схема работы

1.  **Бэкенд (Go)** отправляет HTTP-запрос (webhook) в n8n с данными для генерации (например, JSON с тегами персонажа).
2.  **n8n** получает запрос и запускает рабочий процесс (workflow).
3.  **Рабочий процесс n8n:**
    - Обрабатывает входящие данные.
    - Формирует промпт для ИИ-модели.
    - Отправляет запрос к ИИ-сервису (например, `ComfyUI` или API локальной LLM).
    - Получает сгенерированное изображение.
    - (Опционально) Обрабатывает изображение (например, изменяет размер, накладывает вотермарку).
    - Отправляет результат (URL на изображение или само изображение) обратно на бэкенд или сохраняет в S3-совместимое хранилище.

## 3. Используемые технологии

- **Платформа автоматизации:** [n8n](https://n8n.io/)
- **Система генерации ИИ:** [ComfyUI](https://github.com/comfyanonymous/ComfyUI) (или другая модель, доступная через API).
- **Хранилище:** S3-совместимое хранилище (например, MinIO) для сгенерированных изображений.

## 4. Этапы разработки

1.  **Развертывание n8n и ComfyUI:** Установка и настройка сервисов (возможно, через Docker).
2.  **Создание рабочего процесса (Workflow) в n8n:**
    - Настройка Webhook-триггера для приема запросов от бэкенда.
    - Создание узлов для обработки данных и формирования промптов.
    - Настройка HTTP-узла для отправки запросов в ComfyUI.
    - Добавление узлов для сохранения результата в хранилище.
3.  **Тестирование:** Отладка рабочего процесса с помощью тестовых запросов.
4.  **Интеграция с бэкендом:** Настройка отправки запросов из Go-приложения в n8n.
5.  **Масштабирование:** Оптимизация рабочего процесса для обработки большого количества запросов.
